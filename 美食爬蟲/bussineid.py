import requests
import pandas as pd

# Google Places API Keyï¼ˆè«‹ç¢ºä¿ API Key æ²’æœ‰ç©ºæ ¼ï¼‰
API_KEY = "AIzaSyCSjgDp4YRLipBUWzKnY0-jPkQSsriAu1w"

# å°åŒ—æ·é‹ç«™åº§æ¨™
taipei_mrt_stations = {
    # ç´…ç·š
    "è±¡å±±": (25.03283, 121.569576),
    "å°åŒ—101/ä¸–è²¿": (25.033102, 121.563292),
    "ä¿¡ç¾©å®‰å’Œ": (25.033326, 121.553526),
    "å¤§å®‰": (25.032943, 121.543551),
    "å¤§å®‰æ£®æ—å…¬åœ’": (25.033396, 121.534882),
    "æ±é–€": (25.033847, 121.528739),
    "ä¸­æ­£ç´€å¿µå ‚": (25.032729, 121.51827),
    "å°å¤§é†«é™¢": (25.041256, 121.51604),
    "å°åŒ—è»Šç«™": (25.046255, 121.517532),
    "ä¸­å±±": (25.052685, 121.520392),
    "é›™é€£": (25.057805, 121.520627),
    "æ°‘æ¬Šè¥¿è·¯": (25.062905, 121.51932),
    "åœ“å±±": (25.071353, 121.520118),
    "åŠæ½­": (25.084873, 121.525078),
    "å£«æ—": (25.093535, 121.52623),
    "èŠå±±": (25.10306, 121.522514),
    "æ˜å¾·": (25.109721, 121.518848),
    "çŸ³ç‰Œ": (25.114523, 121.515559),
    "å”­å“©å²¸": (25.120872, 121.506252),
    "å¥‡å²©": (25.125491, 121.501132),
    "åŒ—æŠ•": (25.131841, 121.498633),
    "æ–°åŒ—æŠ•": (25.136933, 121.50253),
    "å¾©èˆˆå´—": (25.137474, 121.485444),
    "å¿ ç¾©": (25.130969, 121.47341),
    "é—œæ¸¡": (25.125633, 121.467102),
    "ç«¹åœ": (25.13694, 121.459479),
    "ç´…æ¨¹æ—": (25.154042, 121.458872),
    "æ·¡æ°´": (25.167818, 121.445561),
    # è—ç·š
    "é ‚åŸ”": (24.96012, 121.4205),
    "æ°¸å¯§": (24.966726, 121.436072),
    "åœŸåŸ": (24.973094, 121.444362),
    "æµ·å±±": (24.985339, 121.448786),
    "äºæ±é†«é™¢": (24.998037, 121.452514),
    "åºœä¸­": (25.008619, 121.459409),
    "æ¿æ©‹": (25.013618, 121.462302),
    "æ–°åŸ”": (25.023738, 121.468361),
    "æ±Ÿå­ç¿ ": (25.03001, 121.47239),
    "é¾å±±å¯º": (25.03528, 121.499826),
    "è¥¿é–€": (25.04209, 121.508303),
    "å–„å°å¯º": (25.044823, 121.523208),
    "å¿ å­æ–°ç”Ÿ": (25.042356, 121.532905),
    "å¿ å­å¾©èˆˆ": (25.041629, 121.543767),
    "å¿ å­æ•¦åŒ–": (25.041478, 121.551098),
    "åœ‹çˆ¶ç´€å¿µé¤¨": (25.041349, 121.557802),
    "å¸‚æ”¿åºœ": (25.041171, 121.565228),
    "æ°¸æ˜¥": (25.040859, 121.576293),
    "å¾Œå±±åŸ¤": (25.045055, 121.582522),
    "æ˜†é™½": (25.050461, 121.593268),
    "å—æ¸¯": (25.052116, 121.606686)
}

def search_restaurants(station, lat, lng, keyword="ç¾é£Ÿ", radius=500):
    """æœå°‹æ·é‹ç«™å‘¨é‚Šçš„ç¾é£Ÿé¤å»³ï¼Œè¿”å› æ·é‹ç«™ã€å•†å®¶ ID å’Œ å•†å®¶åç¨±"""
    url = "https://maps.googleapis.com/maps/api/place/nearbysearch/json"
    params = {
        "location": f"{lat},{lng}",
        "radius": radius,
        "keyword": keyword,
        "type": "restaurant",
        "key": API_KEY
    }
    response = requests.get(url, params=params)
    
    # æª¢æŸ¥ API æ˜¯å¦æˆåŠŸè¿”å›çµæœ
    data = response.json()
    if "error_message" in data:
        print(f"âš ï¸ Google Places API éŒ¯èª¤ï¼š{data['error_message']}")
        return []
    
    return [{"æ·é‹ç«™": station, "å•†å®¶ID": r["place_id"], "å•†å®¶åç¨±": r["name"]} for r in data.get("results", [])]

# å­˜æ”¾çµæœ
restaurants_data = []

for station, (lat, lng) in taipei_mrt_stations.items():
    print(f"ğŸ“ æ­£åœ¨æŠ“å– {station} é™„è¿‘çš„é¤å»³...")
    restaurants = search_restaurants(station, lat, lng)
    restaurants_data.extend(restaurants)

# å„²å­˜ç‚º CSVï¼ˆåŒ…å« æ·é‹ç«™ã€å•†å®¶ID å’Œ å•†å®¶åç¨±ï¼‰
df = pd.DataFrame(restaurants_data)
df.to_csv("taipei_mrt_businesses.csv", index=False, encoding="utf-8-sig")

print("âœ… çˆ¬å–å®Œæˆï¼å·²å„²å­˜ taipei_mrt_businesses.csv")
