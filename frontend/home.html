<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦–é </title>
    <link rel="stylesheet" href="static/css/homepage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css">
</head>
<body>
    <div class="container">
        <!-- é ‚éƒ¨æ¨™é¡Œ -->
        <header class="header">
            <div class="user-info">
                <span id="userEmail"></span>
                <button id="logoutBtn" class="logout-btn">ç™»å‡º</button>
            </div>
            <h1>MEIé£Ÿä¸æ‰“çƒŠ</h1>
            <h2>Taipei Metro</h2>
        </header>


        <!-- æœå°‹åˆ— -->
        <div class="search-bar">
            <input id="station-from" class="awesomplete" placeholder="å‡ºç™¼ç«™">
            <button id="swap-btn">ğŸ”„</button>
            <input id="station-to" class="awesomplete" placeholder="ç›®çš„ç«™">
        </div>


        <!-- æ·é‹ç«™åœ–ç‰‡ -->
        <div class="station-image">
            <img src="åœ–ç‰‡/mm.jpg" alt="æ·é‹ç«™åœ–ç‰‡">
        </div>


        <!-- åŠŸèƒ½æŒ‰éˆ• -->
        <div class="features">
            <a href="nightowl.html" class="feature-btn">
                <img src="åœ–ç‰‡/animal.png" alt="å¤œè²“å­" class="icon">
                <span>å¤œè²“å­å°ˆå€</span>
            </a>
            <a href="checkin.html" class="feature-btn">
                <img src="åœ–ç‰‡/target.png" alt="æ‰“å¡ä»»å‹™" class="icon">
                <span>æ‰“å¡ä»»å‹™</span>
            </a>
            <a href="timetable.html" class="feature-btn">
                <img src="åœ–ç‰‡/timetable.png" alt="æ·é‹æ™‚åˆ»è¡¨" class="icon">
                <span>æ·é‹æ™‚åˆ»è¡¨</span>
            </a>
        </div>


        <!-- TOP10åº—å®¶ -->
        <section class="top-shops">
            <h3>ç•¶æœˆTOP10åº—å®¶</h3>
            <div class="shop-list">
                <div class="shop-item"></div>
                <div class="shop-item"></div>
                <div class="shop-item"></div>
                <div class="shop-item"></div>
                <div class="shop-item"></div>
            </div>
        </section>


        <!-- å›ºå®šåº•éƒ¨å°èˆªåˆ— -->
        <nav class="footer">
            <a class="nav-btn" id="home" href="home.html">
                <img src="åœ–ç‰‡/home.png" alt="é¦–é ">
                <span>é¦–é </span>
            </a>
           
            <a class="nav-btn active" id="map" href="food_map.html">
                <img src="åœ–ç‰‡/map.png" alt="ç¾é£Ÿåœ°åœ–">
                <span>ç¾é£Ÿåœ°åœ–</span>
            </a>
            <a class="nav-btn" href="notifications.html">
                <img src="åœ–ç‰‡/bell.png" alt="é€šçŸ¥">
                <span>é€šçŸ¥</span>
            </a>
            <a class="nav-btn" href="profile.html">
                <img src="åœ–ç‰‡/user.png" alt="æœƒå“¡ä¸­å¿ƒ">
                <span>æœƒå“¡ä¸­å¿ƒ</span>
            </a>
        </nav>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <script src="/static/js/home_page/stationdata.js"></script>
    <script>
        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        window.onload = async function() {
            try {
                console.log('æ­£åœ¨æª¢æŸ¥ç™»å…¥ç‹€æ…‹...');
                const response = await fetch('http://140.131.115.97:8000/api/accounts/user/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                });
               
                console.log('ç™»å…¥ç‹€æ…‹æª¢æŸ¥å›æ‡‰:', response.status);
               
                if (response.ok) {
                    const data = await response.json();
                    console.log('ä½¿ç”¨è€…è³‡æ–™:', data);
                    document.getElementById('userEmail').textContent = data.email;
                } else if (response.status === 401) {
                    // å¦‚æœæ˜¯æœªæˆæ¬Šï¼ˆæœªç™»å…¥ï¼‰ï¼Œæ‰è·³è½‰åˆ°ç™»å…¥é é¢
                    console.log('ä½¿ç”¨è€…æœªç™»å…¥ï¼Œè·³è½‰åˆ°ç™»å…¥é é¢');
                    window.location.href = 'index.html';
                } else {
                    // å…¶ä»–éŒ¯èª¤ï¼Œä¸è·³è½‰ï¼Œåªé¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
                    console.error('æª¢æŸ¥ç™»å…¥ç‹€æ…‹å¤±æ•—:', response.status);
                }
            } catch (error) {
                // ç¶²çµ¡éŒ¯èª¤ç­‰ï¼Œä¸è¦è·³è½‰ï¼Œåªé¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
                console.error('æª¢æŸ¥ç™»å…¥ç‹€æ…‹æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        };


        // ç™»å‡ºåŠŸèƒ½
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                const response = await fetch('http://140.131.115.97:8000/api/accounts/logout/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                });
               
                // ä¸ç®¡æˆåŠŸèˆ‡å¦ï¼Œéƒ½ç›´æ¥è·³è½‰åˆ°ç™»å…¥é é¢
                window.location.replace('index.html');
            } catch (error) {
                // ç™¼ç”ŸéŒ¯èª¤æ™‚ä¹Ÿç›´æ¥è·³è½‰åˆ°ç™»å…¥é é¢
                window.location.replace('index.html');
            }
        });
    </script>
</body>
</html>


